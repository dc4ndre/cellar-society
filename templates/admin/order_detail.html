{% extends "admin/base.html" %}

{% block title %}Order Details - Cellar Society{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Order Details #{{ order.id }}</h2>
    <p>Complete order information and status</p>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
    <!-- Order Information -->
    <div class="card">
        <h3>Order Information</h3>
        <div style="margin-top: 20px;">
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Order ID</p>
                <p style="font-weight: 700; color: var(--primary); font-size: 1.3em;">#{{ order.id }}</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Order Status</p>
                {% if order.status == 'Pending' %}
                    <span class="badge warning" style="font-size: 16px; padding: 8px 16px;">Pending</span>
                {% elif order.status == 'Processing' %}
                    <span class="badge primary" style="font-size: 16px; padding: 8px 16px;">Processing</span>
                {% elif order.status == 'Delivered' %}
                    <span class="badge success" style="font-size: 16px; padding: 8px 16px;">Delivered</span>
                {% elif order.status == 'Received' %}
                    <span class="badge success" style="font-size: 16px; padding: 8px 16px;">Received</span>
                {% elif order.status == 'Cancelled' %}
                    <span class="badge danger" style="font-size: 16px; padding: 8px 16px;">Cancelled</span>
                {% else %}
                    <span class="badge" style="font-size: 16px; padding: 8px 16px;">{{ order.status }}</span>
                {% endif %}
            </div>

            <!-- Status Update Form -->
            {% if order.status not in ['Received', 'Cancelled'] %}
            <div style="margin-bottom: 16px; padding: 16px; background: rgba(198, 166, 100, 0.05); border-radius: 8px; border-left: 4px solid var(--accent);">
                <p style="font-weight: 600; color: var(--primary); margin-bottom: 12px;">Update Order Status</p>
                <form method="POST" action="{{ url_for('update_order_status', order_id=order.id) }}">
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <select name="status" required
                                style="flex: 1; padding: 10px 12px; border-radius: 6px; border: 2px solid var(--accent); font-size: 14px; font-weight: 500;">
                            <option value="">Select new status...</option>
                            {% if order.status == 'Pending' %}
                                <option value="Processing">Processing</option>
                                <option value="Cancelled">Cancelled</option>
                            {% elif order.status == 'Processing' %}
                                <option value="Delivered">Delivered</option>
                            {% elif order.status == 'Delivered' %}
                                <option value="Received">Received</option>
                            {% endif %}
                        </select>
                        <button type="submit" class="btn accent" onclick="return confirm('Confirm status update?');">
                            Update
                        </button>
                    </div>
                </form>
            </div>
            {% endif %}
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Order Date</p>
                <p style="font-weight: 600;">{{ order.order_date }}</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Quantity</p>
                <p style="font-weight: 600;">{{ order.quantity }} bottle(s)</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Total Price</p>
                <p style="font-weight: 700; color: var(--accent); font-size: 1.8em;">₱{{ "%.2f"|format(order.total_price) }}</p>
            </div>
        </div>
    </div>
    
    <!-- Customer Information -->
    <div class="card">
        <h3>Customer Information</h3>
        <div style="margin-top: 20px;">
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Customer Name</p>
                <p style="font-weight: 600; color: var(--primary);">{{ order.customer_name }}</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Email Address</p>
                <p style="font-weight: 600;">{{ order.customer_email }}</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Phone Number</p>
                <p style="font-weight: 600;">{{ order.customer_phone if order.customer_phone else 'Not provided' }}</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Shipping Address</p>
                <p style="font-weight: 600;">{{ order.customer_address if order.customer_address else 'Not provided' }}</p>
            </div>
            
            <a href="{{ url_for('customer_detail', customer_id=order.customer_id) }}" class="btn ghost" style="margin-top: 12px; width: 100%;">View Full Customer Profile</a>
        </div>
    </div>
</div>

<!-- Product Details -->
<div class="card">
    <h3>Product Details</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
        <div>
            <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Wine Name</p>
            <p style="font-weight: 600; color: var(--primary); font-size: 1.1em;">{{ order.product_name }}</p>
        </div>
        
        <div>
            <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Wine Type</p>
            <span class="badge primary" style="padding: 8px 14px;">{{ order.product_type }}</span>
        </div>
        
        <div>
            <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Region</p>
            <p style="font-weight: 600;">{{ order.product_region }}</p>
        </div>
        
        <div>
            <p style="color: var(--muted); font-size: 13px; margin-bottom: 4px;">Vintage</p>
            <p style="font-weight: 600;">{{ order.product_vintage }}</p>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div style="display: flex; gap: 12px;">
    <a href="{{ url_for('orders') }}" class="btn ghost">← Back to Orders</a>
    <a href="{{ url_for('products') }}" class="btn accent">View All Products</a>
</div>

{% endblock %}